<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <!--
      This Amos Professional Manual is written by asymetrix for the Amiga community and should stay completly FREE FOREVER.
      Created 2008. :)
  -->
  <title>Amos Professional Manual - The AMAL Editor</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="keywords" content="Amos Professional, Amiga, Programming, Basic, Francois Lionet, Europress Software Ltd, Amos, computing, code, AmigaDOS">
  <meta name="author" content="asymetrix">

</head>

<body bgcolor="white">

<section>
<h1>The AMAL Editor</h1>



<p>
The AMAL Editor accessory allows you to pack your AMAL programs into a single memory
bank, so that routines can be entered directly from the keyboard and edited on screen.
All of the AMAL Editor features are called up via drop-down menus, which include a built-in
monitoring system for rapid debugging, and a movement-pattern recorder.</p>

<p>
The AMAL Editor can be used as an accessory, in which case memory banks defined by your
main program will be grabbed automatically, or it can be used as a normal AMOS Professional
program.</p>

<p>Please select the AMAL Editor now, from the AMOSPro_Accessories disc.</p>
</section>

<section id="01-the-amal-string-editor-screen">
<h2>The AMAL String Editor Screen</h2>
<p>
After loading, the AMAL Editor displays its main String Editor Screen, which is always allocated
to screen number <b>seven</b>, and which is where AMAL program strings are created for storing in
the AMAL bank. Please remember not to use this screen number for your own programs, when
using the Editor. The screen is divided into three horizontal zones, as follows:</p>

<p><b>The Information Line</b><br>
At the top of the screen, a black Information Line lists the current mode and also displays the
AMAL channel number currently being edited. All of the drop-down menus are triggered by
clicking in this Information Line, using the <b>right</b> mouse button. By using the <b>left</b> mouse button
and then dragging the Information Line up and down, the entire String Editor Screen can be
moved vertically, to reveal the current program display.</p>

<p><b>The Selection Window</b><br>
Below the Information Line, there is a grey Selection Window. This is where any of the AMAL
programs that are stored in memory can be selected for editing. In the centre of this window
there are two rows of characters, one above the other. These items are read <b>vertically</b>, so the
item on the left-hand side reads EE, which refers to the Environment Editor, which is explained
at the end of this Chapter. The Next item refers to channel 00, then channel 01, all the way along
to channel 15.</p>

<p>
When one of these programs is selected with the <b>left</b> mouse button, it is highlighted in inverse
video, and loaded to the Editor Window. There is a [Synchro On/Off] feature, which is
explained later, and if the [Synchro Off] option is selected, the number of channels is extended
from 16 to 62. In this case, only the first 16 of these routines can be performed using the standard
AMAL interrupt system.</p>

<p><b>The Editor Window</b><br>
This is the large orange panel that occupies most of the screen, and it operates in a similar way
to a normal AMOS Professional Edit window. AMAL programs can be entered at the current
cursor position directly from the keyboard, and the mouse can be used to move the position of
the editing cursor directly.</p>


<p>Here is a list of the editing controls:</p>

<pre>
[Return]                   Insert a line
[Ctrl]+[Y]                 Delete a line
[Tab]                      Jump to next Tab position
[Cursor arrows]            Move cursor one place up, down, left or right
[Shift]+[Cursor arrows]    Move cursor to start / end of line, or top / bottom of screen
</pre>

<p><b>Lower drag bar</b><br>
At the bottom of the String Editor Screen, there is a black bar, which can be dragged vertically
using the left mouse button, to reveal the current program display.</p>
</section>

<section id="02-the-amal-editor-menus">
<h2>The AMAL Editor Menus</h2>
<p>
There are five drop-down menus, located along the left-hand side of the Information Line.
These are called up and activated using the right mouse button. Here is a guided tour of all the
menu options, from left to right.</p>
</section>

<section id="03-amos-menu">
<h2>AMOS menu</h2>
<p>
This simple menu offers the following three options:</p>

<p><b>[About AMAL Editor]</b><br>
This displays a memory status report, showing the current text buffer free space, free chip
memory and free fast memory.</p>

<p><b>[Quit Esc]</b><br>
To get back to the AMOS Professional Edit window, click on the [Quit] option, or press the [Esc]
key. You will be asked to confirm your action with a [Y/N1.</p>

<p><b>[Back to system]</b><br>
This will leave AMOS Professional altogether, and take you to the Workbench screen. If you
insist on leaving the comforts of AMOS Professional, you should trigger the [Really?] option.</p>
</section>

<section id="04-edit-menu">
<h2>Edit menu</h2>
<p>
Once AMAL programs have been loaded into memory, they can be run using one of the options
in the Edit menu, triggered by the right mouse button, as before. Here is the choice of available
options:</p>

<p><b>[Run All] or [F1]</b><br>
This calls the AMAL Environment string, which is explained later, and executes all existing
AMAL programs simultaneously.</p>

<p><b>[Run Current] or [F2]</b><br>
Trigger this option to initialise the screen and execute the single AMAL program that is currently
being edited. Once the program is running, you may return to the AMAL Editor window at any
time by pressing a key.</p>


<p><b>[Run Selected] or [F3]</b><br>
This performs the same task as [Run Current] or [F2], but instead of the current single program,
the highlighted program in the Selection Window will be run.</p>

<p><b>[Monitor] or [F4] The AMAL Monitor</b><br>
As soon as this option is selected, a new screen is displayed featuring all of the AMAL Monitor
options. This monitoring device allows you to step through your program one instruction at a
time. At the top of the Monitor screen there is a selection window, showing the list of currently
active programs. All of these programs will be executed simultaneously, so you must de-activate
any that you are not immediately interested in. Click on any of these, to turn off the highlight
selection.</p>

<p>
Because all of the AMAL registers can be accessed directly from this screen, it is very simple to
isolate any errors and cure them. All options are selected by clicking on the screen, or by
pressing the associated key. To cancel a selection, simply press the [Esc] key. Here are the
operating steps for using the AMAL Monitor:</p>

<ul>
  <li><b>Initialise</b>. Before using any of the Monitor options, press [I] or click on [Init screen and
      AMAL], which is the initialisation option at the top of the right-hand option stack. This runs
      the environment routine and prepares the Monitor for use.</li>
  <li><b>External Registers</b>. On the left of the Monitor window there are two vertical displays,
      showing all 26 of the external registers, from RA to RZ. These can be changed at any time by
      clicking on the chosen register with the left mouse button, then entering a new value in
      hexadecimal.</li>
  <li><b>Internal Registers</b>. The central panel displays the internal registers in the format R(channel
      number,register number). Each AMAL program has its own individual set of internal registers,
      and they can be examined by clicking on one of the direction-arrow icons underneath the
      Internal register display panel, to display R(0,0) up to R(15,9). To set a register, highlight it
      with the left mouse button, and enter a new hexadecimal value from the keyboard.</li>
  <li><b>Option Panel</b>. You may test your routine by selecting any of the other options in the right-
      hand panel, once the system has been initialised. These are self-explanatory, as follows:
</ul>


<pre>
[R] or [Run until key press]
[G] or [Go until Reg=Value]
[S] or [Perform one step]
[Esc] or [Quit Monitor]
</pre>

<p>
We will now examine the final option in the [Edit] menu, which is to be found below the
[Monitor] option.</p>

<p><b>[Play Editor] or [F5]</b><br>
Two sub-menus are offered here, [Back to String Editor Esc] will take you straight back to the
main String Editor Window. The alternative option allows you to exploit some AMAL magic!
This [Movement] menu is explained next.</p>

<p><b>[Movement]</b><br>
Here are the options available from this sub-menu, from top to bottom:</p>


<p><b>[Record] or [F1]</b><br>
This records a movement pattern and stores it in the AMAL memory bank. A full explanation of
recording and playing movement patterns is explained below.</p>

<p><b>[Playback] or [F2]</b><br>
Use this option to replay a pre-recorded movement pattern.</p>

<p><b>[Insert] or [F3]</b><br>
This option is used to insert a new pattern at the current position. Any patterns after this
insertion point will be shifted one place to the right, unless it is the 48th pattern in the list, in
which case it will fall off the end of the list and be lost!</p>

<p><b>[Delete] or [F4]</b><br>
Use this to erase the current movement pattern. All subsequent patterns in the list will now be
shifted one position to the left.</p>
</section>

<section id="05-recording-and-playing-movement-patterns">
<h2>Recording and playing movement patterns</h2>

<p>
The [Play Editor] option allows you to record a complex movement pattern, by repeatedly
logging the position of the mouse cursor as it is moved across the screen, and storing this
movement data in the AMAL memory bank. The movement pattern can then be used to
animate almost any Object you like! Here is the procedure for using this technique:</p>

<ul>
  <li>Select the [Play Editor] from the [Edit] menu. Remember that the display can be repositioned
      using the black horizontal bar.</li>
  <li>Choose the pattern number you want to define, by highlighting the appropriate item in the
      Selection Window.</li>
  <li>Call the [Record] option from the [Movement] sub-menu, and instructions will appear on
      screen regarding the current recording speed. The delay between each recorded mouse
      position is set in 50ths of a second, and the default setting offers the smoothest results.
      Alternatively, a slower setting can be used to save memory, sacrificing a degree of smoothness.</li>
      The easiest way to discover what suits you best is to experiment.</li>
  <li>Move the mouse to the start position for the proposed animation sequence, and press [Return]
      to start the recording operation.</li>
  <li>Now move the mouse at will, and the mouse cursor position will be recorded continuously at
      the sampling rate you have chosen, until you halt the process by pressing the <b>left</b> mouse
      button.</li>
  <li>Repeat the above sequences if necessary, and when you want to view the recorded animation
      pattern, select the [Play back] option from the [Movement] sub-menu.</li>
</ul>
</section>

<section id="06-the-disc-menu">
<h2>The Disc Menu</h2>
<p>
This simple menu is called from the Information Line, using the right mouse button. It offers
three self-explanatory options, as follows:</p>

<p><b>[Load AMAL bank]</b><br>
This calls the File Selector, from which the selected AMAL bank can be loaded.</p>


<p><b>[Save AMAL bank]</b><br>
The current bank will be saved to an appropriate disc, whose directory is read into the File
Selector on screen.</p>

<p><b>[Save As]</b><br>
To change the name of the current AMAL bank before saving to disc, use this option.</p>
</section>

<section id="07-the-option-menu">
<h2>The Option Menu</h2>
<p>
This simple menu is employed to control the SYNCHRO facility, used to bypass the limitations
of the Amiga's, interrupt system. If you need reminding of how this works, please refer to the
SYNCHRO ON and SYNCHRO OFF section in <a href="07-06-amal.html">Chapter 7.6</a> of this User Guide.</p>

<p><b>[Synchro On]</b><br>
This option is toggled with the [SYNCHRO OFF] setting, when triggered by the right mouse
button.</p>

<p><b>[Set Period]</b><br>
This allows the period between each SYNCHRO to be set for all AMAL programs, and is
prompted by on-screen instructions.</p>

<p><b>[Set Selected]</b><br>
This works as above, but only affects the highlighted selection of AMAL programs.</p>
</section>

<section id="08-the-block-menu">
<h2>The Block Menu</h2>
<p>
The last of the five menus in the AMAL Editor is a straightforward utility for manipulating
blocks of your AMAL string, rapidly and simply. As with the Blocks menu available from the
AMOS Professional Edit Screen, the start and end positions of the block are first marked, and
then manipulated by cutting, pasting, hiding or printing. Here is the Block Menu layout:</p>

<p>
<b>[Block Start]</b> or <b>[F6]</b><br>
<b>[Block End]</b> or <b>[F7]</b><br>
<b>[Block Hide]</b> or <b>[F8]</b><br>
<b>[Block Cut]</b> or <b>[F9]</b><br>
<b>[Block Paste]</b> or <b>[F10]</b><br>
<b>[Block Print]</b><br>
<b>[String Print]</b></p>
</section>

<section id="09-the-environment-generator">
<h2>The Environment Generator</h2>
<p>
The vast majority of AMAL routines will normally need initialisation from the main AMOS
Professional program. To make operations more convenient, the AMAL Editor includes a
stripped-down version of the AMOS Professional interpreter called the Environment Generator.
This allows you to perform all of the initialisation routines directly from the AMAL Editor,
without the need to return to the main AMOS Professional program.</p>

<p>
A program written with the Environment Generator can be entered from the AMAL Editor
exactly as if it is a normal AMOS Professional program, as follows:</p>

<ul>
  <li>Click on the EE (Environment Editor) option in the selection window.</li>
  <li>Type in the program from the keyboard, and it will be saved as part of
      the current memory bank automatically.</li>
</ul>


<ul>
  <li>The program will now be executed whenever an AMAL program is run from the Editor.</li>
  <li>Please note that if you want to call AMAL routines from the main AMOS Professional
      program, the Environment commands that are listed below must first be converted into
      normal AMOS Professional commands, and the appropriate lines added at the start of this
      code. Also note that if Bobs are being used, a SCREEN instruction must be used to direct the
      output to your own screen, otherwise the Bobs will be drawn to the default AMAL Editor
      screen number 7.
</ul>

<p>
These AMAL Editor commands are similar to their AMOS Professional equivalents, except for
the fact that they have been simplified to save memory. Here is a full list of commands that can
be used by the AMAL Editor system:</p>

<pre>
<b>AMAL Environment Command     Notes</b>
'                            REM, used at the start of a line
SCREEN OPEN                  same as AMOS Professional
SCREEN DISPLAY               same as AMOS Professional
SCREEN OFFSET                same as AMOS Professional
SCREEN                       same as AMOS Professional
SCREEN CLOSE                 close all screens
SCREEN CLONE                 same as AMOS Professional
DOUBLE BUFFER                same as AMOS Professional
DUAL PLAY FIELD              same as AMOS Professional
DUAL PRIORITY                same as AMOS Professional
LOAD IFF "filename",screen   the screen number MUST be given
LOAD "filename",bank         the bank number MUST be given
ERASE bank                   same as AMOS Professional
HIDE ON                      same as AMOS Professional
UPDATE EVERY                 same as AMOS Professional
FLASH                        same as AMOS Professional
FLASH OFF                    same as AMOS Professional
SET RAINBOW                  same as AMOS Professional
RAINBOW                      same as AMOS Professional
RAINBOW DEL                  delete any RAINBOW effects
BOB                          same as AMOS Professional
SET BOB                      same as AMOS Professional
BOB OFF                      remove all Bobs from screen
SPRITE                       same as AMOS Professional
SPRITE OFF                   remove all Sprites from screen
SET SPRITE BUFFER            same as AMOS Professional
SET REG number,value         set AMAL register A to Z or 0 to 25
CHANNEL TO SPRITE channel,Sprite
CHANNEL TO BOB channel,Bob
CHANNEL TO SCREEN OFFSET channel,screen
CHANNEL TO SCREEN SIZE channel,screen
CHANNEL TO RAINBOW channel,rainbow
</pre>


<p>
A range of useful Test instructions is available, and they all use the same general syntax, as
follows:</p>

<p>INSTRUCTION condition : list of statements</p>

<p>
The statements after the condition will only be executed if the condition is True, otherwise the
following commands will be completely ignored and the program will jump directly to the next
line of this Environment routine:</p>

<pre>
<b>AMAL Environment Command                     Notes</b>

IF SCREEN number                             True if the screen has been opened
IF NOT SCREEN number                         True if the screen is currently closed
IF BANK number                               True if the bank has been reserved
IF NOT BANK number                           True if the bank is not reserved
IF REG number,value                          True if Reg A to Z or 0 to 25 equals value
</pre>

<p>To get you started, type in these texts:</p>

<pre>
E> Screen Open 0,320,200,16,Lowres
   Double Buffer
   Load "AMOSPro_Tutorial:Objects/Bobs.Abk",1
   Channel To Bob 0,1
   Screen 0
   Bob 1,100,100,1
   AMAL Channel 0
   Let X=0;
   Let Y=0;
   L:
   Let X=X+1;
   Let Y=Y+1;
   Pause;
   Jump;
</pre>


</section>

</BODY>
</HTML>